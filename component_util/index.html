
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Manual for the wai-annotations library for converting various annotation formats into each other">
      
      
      
        <link rel="canonical" href="https://ufdl.cms.waikato.ac.nz/wai-annotations-manual/component_util/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Utility Components - wai-annotations manual</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.472b142f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.08040f6c.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="None" data-md-color-accent="None">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#utility-components" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="wai-annotations manual" class="md-header__button md-logo" aria-label="wai-annotations manual" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            wai-annotations manual
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Utility Components
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="wai-annotations manual" class="md-nav__button md-logo" aria-label="wai-annotations manual" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    wai-annotations manual
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../usage/" class="md-nav__link">
        Usage
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Examples" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples_overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples_formats/" class="md-nav__link">
        Format conversions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples_audio/" class="md-nav__link">
        Audio processing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples_imgaug/" class="md-nav__link">
        Image dataset augmentation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples_imgstats/" class="md-nav__link">
        Image dataset statistics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples_imgvis/" class="md-nav__link">
        Image dataset visualizations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples_video/" class="md-nav__link">
        Video handling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples_redis_predictions/" class="md-nav__link">
        Predictions via Redis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples_generic/" class="md-nav__link">
        Generic plugin wrappers
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../docker/" class="md-nav__link">
        Docker
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../architecture_overview/" class="md-nav__link">
        Architecture overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../plugin/" class="md-nav__link">
        Plugin guide
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../domains/" class="md-nav__link">
        Domains
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../plugins/" class="md-nav__link">
        Plugins
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#utility-components" class="md-nav__link">
    Utility Components
  </a>
  
    <nav class="md-nav" aria-label="Utility Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#input" class="md-nav__link">
    Input
  </a>
  
    <nav class="md-nav" aria-label="Input">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#localfilenamesource" class="md-nav__link">
    LocalFilenameSource
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#annotationfileprocessor" class="md-nav__link">
    AnnotationFileProcessor
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output" class="md-nav__link">
    Output
  </a>
  
    <nav class="md-nav" aria-label="Output">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#localfilewriter" class="md-nav__link">
    LocalFileWriter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#separatefilewriter" class="md-nav__link">
    SeparateFileWriter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jsonfilewriter" class="md-nav__link">
    JSONFileWriter
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#splitting" class="md-nav__link">
    Splitting
  </a>
  
    <nav class="md-nav" aria-label="Splitting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#splitsink" class="md-nav__link">
    SplitSink
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#splitstate" class="md-nav__link">
    SplitState
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requiresnosplitfinalisation" class="md-nav__link">
    RequiresNoSplitFinalisation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#withpersistentsplitfiles" class="md-nav__link">
    WithPersistentSplitFiles
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other" class="md-nav__link">
    Other
  </a>
  
    <nav class="md-nav" aria-label="Other">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#buffer" class="md-nav__link">
    Buffer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enumerator" class="md-nav__link">
    Enumerator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#withrandomness" class="md-nav__link">
    WithRandomness
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Utility Components</h1>

<h2 id="utility-components">Utility Components<a class="headerlink" href="#utility-components" title="Permanent link">#</a></h2>
<p>wai-annotations comes with some utility base-classes for common types of components, found in the
<code>wai.annotations.core.component.util</code> package. They are listed here.</p>
<h3 id="input">Input<a class="headerlink" href="#input" title="Permanent link">#</a></h3>
<h4 id="localfilenamesource">LocalFilenameSource<a class="headerlink" href="#localfilenamesource" title="Permanent link">#</a></h4>
<p>TODO</p>
<h4 id="annotationfileprocessor">AnnotationFileProcessor<a class="headerlink" href="#annotationfileprocessor" title="Permanent link">#</a></h4>
<p>TODO</p>
<h3 id="output">Output<a class="headerlink" href="#output" title="Permanent link">#</a></h3>
<h4 id="localfilewriter">LocalFileWriter<a class="headerlink" href="#localfilewriter" title="Permanent link">#</a></h4>
<p>TODO</p>
<h4 id="separatefilewriter">SeparateFileWriter<a class="headerlink" href="#separatefilewriter" title="Permanent link">#</a></h4>
<p>TODO</p>
<h4 id="jsonfilewriter">JSONFileWriter<a class="headerlink" href="#jsonfilewriter" title="Permanent link">#</a></h4>
<p>TODO</p>
<h3 id="splitting">Splitting<a class="headerlink" href="#splitting" title="Permanent link">#</a></h3>
<h4 id="splitsink">SplitSink<a class="headerlink" href="#splitsink" title="Permanent link">#</a></h4>
<p>Specialised sink component for handling splitting the stream of processed items among a group of splits. Takes 2
options: <code>--split-names</code>, followed by a name for each split; and <code>--split-ratios</code>, followed by an integer ratio of
how many items to add to each split. The sink component will then alternate which split it is acting on behalf of for
each item it receives. The alternation is designed so that at any stage, the ratio of items processed for each split is
as close as possible to the specified <code>--split-ratios</code>.</p>
<p>Sub-classes of <code>SplitSink</code> should implement the <code>consume_element_for_split</code>/<code>finish_split</code> methods, similar to an
ordinary sink component. During execution of either of these methods, the following information can be utilised:</p>
<ul>
<li><code>self.is_splitting</code>: whether the user specified any splits to perform.</li>
<li><code>self.split_label</code>: the label of the current split (specified by <code>--split-names</code>). This is <code>None</code> if splits weren't
  specified.</li>
</ul>
<p>The following sections detail additional functionality that can be added to split-sinks.</p>
<h4 id="splitstate">SplitState<a class="headerlink" href="#splitstate" title="Permanent link">#</a></h4>
<p>Specialised form of <a href="../stream/#ProcessState">process state</a> which manages separate state for each split. Accessing this
property will return a separate instance depending on which split the component is currently acting for.</p>
<h4 id="requiresnosplitfinalisation">RequiresNoSplitFinalisation<a class="headerlink" href="#requiresnosplitfinalisation" title="Permanent link">#</a></h4>
<p>Specialised form of <a href="../stream/#RequiresNoFinalisation">the RequiresNoFinalisation mixin</a>, which declares that the
split-sink doesn't need to perform any clean-up after all items have been processed. This automatically implements
<code>finish_split</code>.</p>
<h4 id="withpersistentsplitfiles">WithPersistentSplitFiles<a class="headerlink" href="#withpersistentsplitfiles" title="Permanent link">#</a></h4>
<p>A mixin class for use with components which inherit from <code>SplitSink</code> and need to keep files open while writing them
across the splits. The <code>_init_split_files</code> method should be implemented to open all files needed by the sink, and return
them as some sort of collection. The <code>_iterate_split_files</code> should iterate over the collection returned by
<code>_init_split_files</code>. Components which implement this mixin can then access the <code>_split_files</code> property during
execution of their <code>consume_element_for_split</code>/<code>finish_split</code> methods to get access to the file-collection for the
current split.</p>
<h3 id="other">Other<a class="headerlink" href="#other" title="Permanent link">#</a></h3>
<p>General-purpose utilities for components.</p>
<h4 id="buffer">Buffer<a class="headerlink" href="#buffer" title="Permanent link">#</a></h4>
<p>This processor component buffers the entire stream, and passes it as a list to the next component in its <code>finish</code>
method.</p>
<h4 id="enumerator">Enumerator<a class="headerlink" href="#enumerator" title="Permanent link">#</a></h4>
<p>This processor component enumerates each item passed to it, forwarding a tuple of the 0-based index of the item and
the item itself.</p>
<h4 id="withrandomness">WithRandomness<a class="headerlink" href="#withrandomness" title="Permanent link">#</a></h4>
<p>This is a mixin class which can be used with any component, and adds a <code>--seed</code> option for randomisation. The help-text
for the option can be specified. If the user sets a seed value, the <code>random</code> property will provide a <code>Random</code> instance
initialised with the provided seed. If the option was not set, <code>None</code> will be returned by the property.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.d6c3db9e.min.js"></script>
      
    
  </body>
</html>
<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>CLI Support in wai-annotations - wai-annotations manual</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "CLI Support in wai-annotations";
    var mkdocs_page_input_path = "cli.md";
    var mkdocs_page_url = "/wai-annotations-manual/cli/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> wai-annotations manual</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../install/">Installation</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../usage/">Usage</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../examples/">Examples</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../plugin/">Plugin guide</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../domains/">Domains</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../plugins/">Plugins</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../glossary/">Glossary</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">wai-annotations manual</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>CLI Support in wai-annotations</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h3 id="cli-support-in-wai-annotations">CLI Support in wai-annotations</h3>
<p>Command-line options are added to wai-annotations at the component level via the use of <code>Option</code> descriptor classes.
This allows for adding command-line options in a declarative style, specifying information about the nature and type of
the options, while letting wai-annotations automatically perform the work of getting information from the user and 
presenting it to the components at run-time.</p>
<p>To add an option to a component, create a class-level variable and assign an <code>Option</code> instance to it (see below for a
description of the available <code>Option</code> types). To read the value of an option as specified by the user, simply access
the class-level variable through the component instance e.g. <code>self.my_option</code> as if it were a property.</p>
<p>N.B. Although options are defined at the component level, wai-annotations aggregates them at the stage level. Therefore,
care must be taken not to use the same flag/s for multiple options, not only within a component (including its
ancestor classes), but also between components that are shared by a stage.</p>
<h4 id="types-of-options">Types of Options</h4>
<h5 id="classoption">ClassOption</h5>
<p>An option for selecting a Python class. Is initialised with a class-registry of the available choices the user can
select from. The user provides the name of a class in the registry and the class itself is returned.</p>
<h5 id="countoption">CountOption</h5>
<p>Option which simply returns the number of times its flag was supplied to the command line. This is useful, for example,
for verbosity values, where increasing the number of flags increases the logging verbosity (e.g. <code>-vvv</code>). An
optional translation table can be provided which translates the actual value to some mapped value.</p>
<h5 id="flagoption">FlagOption</h5>
<p>A simple flag, which evaluates to True when provided on the command-line, or False if not (these semantics can be
inverted).</p>
<h5 id="typedoption">TypedOption</h5>
<p>The most versatile option, it takes a type to use to parse the command-line string/s provide by the user. Can return
a single-value of that type or a list of values of that type if set to take multiple arguments.</p>
<h4 id="example">Example</h4>
<p>This example creates a processor component which takes a schedule of integers from the command line, and multiplies
incoming integers by the next integer in the schedule.</p>
<pre><code class="language-python"># For typing the schedule
from typing import List

# The type of component we are making
from wai.annotations.core.component import ProcessorComponent  # or SourceComponent, or SinkComponent

# The type of option we want to add to our component
from wai.common.cli.options import TypedOption  # or ClassOption, or CountOption, or FlagOption

# We need some process-state to track where we are in the schedule. We output results as we get them, so no
# buffering occurs and therefore no finalisation is necessary
from wai.annotations.core.stream.util import ProcessState, RequiresNoFinalisation

# Type definitions for the streaming callbacks
from wai.annotations.core.stream import ThenFunction, DoneFunction


class MyProcessorComponent(
    RequiresNoFinalisation,
    ProcessorComponent[int, int]  # Processes integers into integers
):
    &quot;&quot;&quot;
    My processor component, which multiplies incoming integers by values in a schedule, passed on the command-line.
    &quot;&quot;&quot;
    # Where we are in the schedule. ProcessState takes an initialiser which is called before processing is started
    # to reset the state for each run. The initialiser takes the instance it is being used for, i.e. self. Here we
    # just initialise the index into the schedule to zero at the beginning of each run.
    schedule_index: int = ProcessState(lambda self: 0)

    # The option which defines the schedule.
    schedule: List[int] = TypedOption(
        &quot;-s&quot;, &quot;--schedule&quot;,  # The short and long flags to identify the option on the command-line
        type=int,  # The type that will be used to parse the command-line values
        action=&quot;concat&quot;,  # This flag can be specified multiple times, subsequent values will be appended to the list
        nargs=&quot;+&quot;,  # Means we can supply one or more values to this flag
        # choices=[...]  # If we wanted to allow choosing only from specific integers
        # default=[...]  # If we had a default schedule in mind. Omission means the default is the empty list
        required=True,  # We need a schedule, the empty list won't do!
        help=&quot;The schedule to multiply values by&quot;,  # Displayed to the user on usage
        metavar=&quot;INT&quot;  # Displayed to the user on usage, describes the type of value that should be supplied
    )

    def process_element(
            self,
            element: int,
            then: ThenFunction[int],
            done: DoneFunction
    ):
        # Multiply the value by the current schedule value
        result = element * self.schedule[self.schedule_index]

        # Forward the calculated value
        then(result)

        # Move to the next position in the schedule
        self.schedule_index = (self.schedule_index + 1) % len(self.schedule)

</code></pre>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
